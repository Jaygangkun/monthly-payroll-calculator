<!doctype html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css/bootstrap.min.css">

    <link rel="stylesheet" href="css/styles.css">

    <script type="text/javascript" src="js/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>

    <script type="text/javascript" src="js/scripts.js"></script>
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-lg-3">
                <div class="calculator-input-wrap">
                    <div class="form-group d-none">
                        <label for="exampleFormControlInput1">Average Monthly Payroll</label>
                        <input type="text" class="form-control" id="average_monthly_payroll" placeholder="" readonly>
                    </div>
                    <div class="form-group">
                        <label for="exampleFormControlInput1"># of Employees</label>
                        <input type="text" class="form-control" id="count_employees" placeholder="" value="5" onkeypress="return isNumberKey(event)">
                    </div>
                    <div class="form-group">
                        <label for="desired_loan_amount">Desired Loan Amount</label>
                        <select class="form-control" id="desired_loan_amount">
                          <option min="100000" max="150000">100,000 - 150,000</option>
                          <option min="150000" max="200000">150,000 - 200,000</option>
                          <option min="200000" max="250000">200,000 - 250,000</option>
                        </select>
                    </div>
                    <button class="btn btn-gradient mb-2" id="btn_gen_scenarios">Show me possible scenarios</button>
                </div>  
            </div>
        </div>
        <div class="row d-none">
            <div class="col-lg-12">
                <div class="calculator-result-wrap">
                    <table class="table table-bordered">
                        <thead class="thead-dark">
                            <tr>
                                <th scope="col">Monthly</th>
                                <th scope="col">Jobs</th>
                                <th scope="col">Monthly Payroll</th>
                                <th scope="col">State Tax</th>
                                <th scope="col">ER Benefits</th>
                                <th scope="col">ER Retirement</th>
                                <th scope="col">Monthly Payroll Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">1/19</th>
                                <td><span id="jobs_1"></span></td>
                                <td><span id="monthly_payroll_1"></span></td>
                                <td><span id="state_tax_1"></span></td>
                                <td><span id="er_benefits_1"></span></td>
                                <td><span id="er_retirement_1"></span></td>
                                <td><span id="monthly_payroll_cost_1"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">2/19</th>
                                <td><span id="jobs_2"></span></td>
                                <td><span id="monthly_payroll_2"></span></td>
                                <td><span id="state_tax_2"></span></td>
                                <td><span id="er_benefits_2"></span></td>
                                <td><span id="er_retirement_2"></span></td>
                                <td><span id="monthly_payroll_cost_2"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">3/19</th>
                                <td><span id="jobs_3"></span></td>
                                <td><span id="monthly_payroll_3"></span></td>
                                <td><span id="state_tax_3"></span></td>
                                <td><span id="er_benefits_3"></span></td>
                                <td><span id="er_retirement_3"></span></td>
                                <td><span id="monthly_payroll_cost_3"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">4/19</th>
                                <td><span id="jobs_4"></span></td>
                                <td><span id="monthly_payroll_4"></span></td>
                                <td><span id="state_tax_4"></span></td>
                                <td><span id="er_benefits_4"></span></td>
                                <td><span id="er_retirement_4"></span></td>
                                <td><span id="monthly_payroll_cost_4"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">5/19</th>
                                <td><span id="jobs_5"></span></td>
                                <td><span id="monthly_payroll_5"></span></td>
                                <td><span id="state_tax_5"></span></td>
                                <td><span id="er_benefits_5"></span></td>
                                <td><span id="er_retirement_5"></span></td>
                                <td><span id="monthly_payroll_cost_5"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">6/19</th>
                                <td><span id="jobs_6"></span></td>
                                <td><span id="monthly_payroll_6"></span></td>
                                <td><span id="state_tax_6"></span></td>
                                <td><span id="er_benefits_6"></span></td>
                                <td><span id="er_retirement_6"></span></td>
                                <td><span id="monthly_payroll_cost_6"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">7/19</th>
                                <td><span id="jobs_7"></span></td>
                                <td><span id="monthly_payroll_7"></span></td>
                                <td><span id="state_tax_7"></span></td>
                                <td><span id="er_benefits_7"></span></td>
                                <td><span id="er_retirement_7"></span></td>
                                <td><span id="monthly_payroll_cost_7"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">8/19</th>
                                <td><span id="jobs_8"></span></td>
                                <td><span id="monthly_payroll_8"></span></td>
                                <td><span id="state_tax_8"></span></td>
                                <td><span id="er_benefits_8"></span></td>
                                <td><span id="er_retirement_8"></span></td>
                                <td><span id="monthly_payroll_cost_8"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">9/19</th>
                                <td><span id="jobs_9"></span></td>
                                <td><span id="monthly_payroll_9"></span></td>
                                <td><span id="state_tax_9"></span></td>
                                <td><span id="er_benefits_9"></span></td>
                                <td><span id="er_retirement_9"></span></td>
                                <td><span id="monthly_payroll_cost_9"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">10/19</th>
                                <td><span id="jobs_10"></span></td>
                                <td><span id="monthly_payroll_10"></span></td>
                                <td><span id="state_tax_10"></span></td>
                                <td><span id="er_benefits_10"></span></td>
                                <td><span id="er_retirement_10"></span></td>
                                <td><span id="monthly_payroll_cost_10"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">11/19</th>
                                <td><span id="jobs_11"></span></td>
                                <td><span id="monthly_payroll_11"></span></td>
                                <td><span id="state_tax_11"></span></td>
                                <td><span id="er_benefits_11"></span></td>
                                <td><span id="er_retirement_11"></span></td>
                                <td><span id="monthly_payroll_cost_11"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">12/19</th>
                                <td><span id="jobs_12"></span></td>
                                <td><span id="monthly_payroll_12"></span></td>
                                <td><span id="state_tax_12"></span></td>
                                <td><span id="er_benefits_12"></span></td>
                                <td><span id="er_retirement_12"></span></td>
                                <td><span id="monthly_payroll_cost_12"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">Total</th>
                                <td><span id="jobs_total"></span></td>
                                <td><span id="monthly_payroll_total"></span></td>
                                <td><span id="state_tax_total"></span></td>
                                <td><span id="er_benefits_total"></span></td>
                                <td><span id="er_retirement_total"></span></td>
                                <td><span id="monthly_payroll_cost_total"></span></td>
                            </tr>
                            <tr>
                                <th scope="row">Average</th>
                                <td><span id="jobs_average"></span></td>
                                <td><span id="monthly_payroll_average"></span></td>
                                <td><span id="state_tax_average"></span></td>
                                <td><span id="er_benefits_average"></span></td>
                                <td><span id="er_retirement_average"></span></td>
                                <td><span id="monthly_payroll_cost_average"></span></td>
                            </tr>
                            <tr>
                                <th scope="row" colspan="2">Loan Amount:</th>
                                <td scope="row" colspan="5"><span id="loan_amount"></span></td>
                            </tr>
                        </tbody>
                      </table>
                </div>
            </div>
        </div>
        <div class="row d-none">
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="exampleFormControlInput1">Avg Monthly</label>
                    <input type="text" class="form-control" id="average_monthly_payroll_result" placeholder="" readonly>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-lg-4">
                <div class="card mb-3 scenario-wrap" id="scenario1">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <p>Employees </p>
                            <span class="text-right block-count-employees"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Average Monthly Payroll </p>
                            <span class="text-right average-monthly-payroll"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Expected Loan Amount	</p>
                            <span class="text-right desired-loan"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card mb-3 scenario-wrap" id="scenario2">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <p>Employees </p>
                            <span class="text-right block-count-employees"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Average Monthly Payroll </p>
                            <span class="text-right average-monthly-payroll"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Expected Loan Amount	</p>
                            <span class="text-right desired-loan"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card mb-3 scenario-wrap" id="scenario3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <p>Employees </p>
                            <span class="text-right block-count-employees"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Average Monthly Payroll </p>
                            <span class="text-right average-monthly-payroll"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Expected Loan Amount	</p>
                            <span class="text-right desired-loan"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card mb-3 scenario-wrap" id="scenario4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <p>Employees </p>
                            <span class="text-right block-count-employees"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Average Monthly Payroll </p>
                            <span class="text-right average-monthly-payroll"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Expected Loan Amount	</p>
                            <span class="text-right desired-loan"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card mb-3 scenario-wrap" id="scenario5">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <p>Employees </p>
                            <span class="text-right block-count-employees"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Average Monthly Payroll </p>
                            <span class="text-right average-monthly-payroll"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Expected Loan Amount	</p>
                            <span class="text-right desired-loan"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card mb-3 scenario-wrap" id="scenario6">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <p>Employees </p>
                            <span class="text-right block-count-employees"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Average Monthly Payroll </p>
                            <span class="text-right average-monthly-payroll"></span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p>Expected Loan Amount	</p>
                            <span class="text-right desired-loan"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    var formatter = new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
    });

    function isNumberKey(evt)
    {
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57))
            return false;
        return true;
    }  

    function randomNumber(min, max) {
        if (min > max) {
            let temp = max;
            max = min;
            min = temp;
        }

        if (min <= 0) {
            return Math.floor(Math.random() * (max + Math.abs(min) + 1)) + min;
        } else {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
    }

    function calcResults(){
        var count_employees = parseInt($('#count_employees').val());

        if($('#count_employees').val() == ''){
            alert('Please Input Employees');
            $('#count_employees').focus();
            return;
        }

        var desired_load_amount_min = parseInt($('#desired_loan_amount').find(':selected').attr('min'));
        var desired_load_amount_max = parseInt($('#desired_loan_amount').find(':selected').attr('max'));
        var desired_loan_amonut = desired_load_amount_min + Math.random() * (desired_load_amount_max - desired_load_amount_min);

        var average_monthly_payroll = desired_loan_amonut / 2.5;
        $('#average_monthly_payroll').val(formatter.format(average_monthly_payroll));

        var total_year_payroll = average_monthly_payroll * 12;

        var biweekly_payroll = total_year_payroll / 26;
        
        var total_jobs             = count_employees * 12;

        var jobs             = [];
        
        for(var month = 0; month < 12; month ++){
            jobs[month] = count_employees;
            if(month == 2 || month == 5 || month == 8 || month == 11){
                jobs[month] = count_employees + randomNumber(-1, 1);
            }
        }

        var monthly_multiples = [
            1, 1, 1, 1, 1.1335, 1.1, 0.9, 0.9, 0.9, 1, 1, 1
        ];
        monthly_multiples = [];

        var multiple_min = 1;
        var multiple_max = 3;
        month = 0;


        // console.log(jobs, monthly_multiples, monthly_multiples.reduce((a, b) => a + b, 0), monthly_multiples.length); return;
        var jobs_total = 0;
        var monthly_payroll_total = 0;
        var state_tax_total = 0;
        var er_benefits_total = 0;
        var er_retirement_total = 0;
        var monthly_payroll_cost_total = 0;
        for(var index = 0; index < 12; index ++){
            var monthly_payroll;
            
            if(index == 4 || index == 9){
                monthly_payroll = biweekly_payroll * 3 * jobs[index] / count_employees;
            }
            else{
                monthly_payroll = biweekly_payroll * 2 * jobs[index] / count_employees;
            }
            
            var state_tax = monthly_payroll * 0.01;
            var er_benefits = 0;
            var er_retirement = 0;
            var monthly_payroll_cost = monthly_payroll + state_tax + er_benefits + er_retirement;

            jobs_total += jobs[index];
            monthly_payroll_total += monthly_payroll;
            state_tax_total += state_tax;
            er_benefits_total += er_benefits;
            er_retirement_total += er_retirement;
            monthly_payroll_cost_total += monthly_payroll_cost;

            var id_index = index + 1;
            $('#jobs_' + id_index).text(jobs[index])
            $('#monthly_payroll_' + id_index).text(formatter.format(monthly_payroll))
            $('#state_tax_' + id_index).text(formatter.format(state_tax))
            $('#er_benefits_' + id_index).text(formatter.format(er_benefits))
            $('#er_retirement_' + id_index).text(formatter.format(er_retirement))
            $('#monthly_payroll_cost_' + id_index).text(formatter.format(monthly_payroll_cost))
        }

        // $('#jobs_total').text(jobs_total);
        $('#monthly_payroll_total').text(formatter.format(monthly_payroll_total));
        $('#state_tax_total').text(formatter.format(state_tax_total));
        $('#er_benefits_total').text(formatter.format(er_benefits_total));
        $('#er_retirement_total').text(formatter.format(er_retirement_total));
        $('#monthly_payroll_cost_total').text(formatter.format(monthly_payroll_cost_total));

        $('#jobs_average').text(Math.round(jobs_total / 12));
        $('#monthly_payroll_average').text(formatter.format(monthly_payroll_total / 12));
        // $('#state_tax_average').text(formatter.format(state_tax_total / 12));
        // $('#er_benefits_average').text(formatter.format(er_benefits_total / 12));
        // $('#er_retirement_average').text(formatter.format(er_retirement_total / 12));
        $('#monthly_payroll_cost_average').text(formatter.format(monthly_payroll_cost_total / 12));

        $('#average_monthly_payroll_result').val(formatter.format(monthly_payroll_total / 12))

        $('#loan_amount').text(formatter.format(monthly_payroll_total * 2.5 / 12));
    }

    $(document).on('keyup', '#count_employees', function(){
        calcResults()
    })

    $(document).on('keyup', '#desired_loan_amount', function(){
        calcResults()
    })

    function generateScenarios(){
        var count_employees = parseInt($('#count_employees').val());

        if($('#count_employees').val() == ''){
            alert('Please Input Employees');
            $('#count_employees').focus();
            return;
        }

        var desired_load_amount_min = parseInt($('#desired_loan_amount').find(':selected').attr('min'));
        var desired_load_amount_max = parseInt($('#desired_loan_amount').find(':selected').attr('max'));

        for(var scenario = 1; scenario < 7; scenario ++){
            var desired_loan_amount = desired_load_amount_min + Math.random() * (desired_load_amount_max - desired_load_amount_min);
            $('#scenario' + scenario).find('.block-count-employees').text(count_employees);
            $('#scenario' + scenario).find('.average-monthly-payroll').text(formatter.format(desired_loan_amount / 2.5));
            $('#scenario' + scenario).find('.desired-loan').text(formatter.format(desired_loan_amount));
        }
    }

    $(document).on('click', '#btn_gen_scenarios', function(){
        calcResults()
        generateScenarios()
    })
</script>